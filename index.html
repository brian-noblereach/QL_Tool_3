<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Content Security Policy - restrict resource loading for XSS protection -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://script.google.com https://script.googleusercontent.com;
    style-src 'self' 'unsafe-inline' https://api.fontshare.com;
    font-src 'self' https://api.fontshare.com https://cdn.fontshare.com;
    connect-src 'self' https://api.stack-ai.com https://script.google.com https://script.googleusercontent.com https://*.smartsheetgov.com https://cdnjs.cloudflare.com;
    img-src 'self' data: https:;
    frame-src https://script.google.com https://script.googleusercontent.com;
  ">
  <title>Venture Assessment | NobleReach</title>
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://api.fontshare.com">
  <link href="https://api.fontshare.com/v2/css?f[]=general-sans@400,500,600,700&f[]=clash-display@500,600,700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="css/styles.css">
  
  <!-- jsPDF for export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <!-- Pilot Banner -->
  <div id="pilot-banner" class="pilot-banner">
    <div class="pilot-banner-content">
      <span class="pilot-badge">PILOT</span>
      <span class="pilot-text">This tool is in pilot testing. Your feedback helps us improve.</span>
      <button id="feedback-btn" class="pilot-feedback-btn">Give Feedback</button>
      <button id="pilot-close" class="pilot-close" aria-label="Close banner">&times;</button>
    </div>
  </div>

  <!-- Main Container -->
  <div class="container">
    <!-- Top Bar -->
    <header class="topbar">
      <div class="brand">
        <img src="assets/logo-icon.svg" alt="NobleReach" class="nr-logo" width="36" height="36">
        <h1 class="brand-title">NobleReach<span class="tm">™</span> Venture Assessment</h1>
        <span class="version-badge">PILOT</span>
      </div>
      <div class="topbar-actions">
        <button id="new-assessment-btn" class="btn outline" title="Start new assessment">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12h14"/>
          </svg>
          New
        </button>
        <button id="export-btn" class="btn" title="Export to PDF" disabled>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
          </svg>
          Export PDF
        </button>
      </div>
    </header>

    <!-- Input Section -->
    <section id="input-section" class="input-section">
      <div class="input-container">
        <div class="input-header">
          <h2>Venture Assessment</h2>
          <p>Enter a company website, upload a document, or provide both to begin the AI-powered analysis. The assessment takes approximately 8-12 minutes to complete.</p>
        </div>
        
        <form id="assessment-form" class="assessment-form">
          <div class="form-row">
            <div class="form-group flex-1">
              <label for="company-url">Company Website URL</label>
              <input 
                type="url" 
                id="company-url" 
                name="company-url" 
                placeholder="https://example.com"
                autocomplete="url"
              >
              <span class="input-hint">Enter the company's website URL (optional if uploading a document)</span>
            </div>
          </div>
          
          <!-- File Upload Section -->
          <div class="form-row">
            <div class="form-group flex-1">
              <label for="company-file">Company Document</label>
              <div class="file-upload-zone" id="file-upload-zone">
                <input 
                  type="file" 
                  id="company-file" 
                  name="company-file" 
                  accept=".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document"
                  class="file-input-hidden"
                >
                <div class="file-upload-content">
                  <div class="file-upload-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                      <polyline points="14 2 14 8 20 8"/>
                      <line x1="12" y1="18" x2="12" y2="12"/>
                      <line x1="9" y1="15" x2="15" y2="15"/>
                    </svg>
                  </div>
                  <div class="file-upload-text">
                    <span class="file-upload-primary">Drop a file here or click to browse</span>
                    <span class="file-upload-secondary">PDF or Word documents accepted</span>
                  </div>
                </div>
                <div class="file-selected-info hidden" id="file-selected-info">
                  <div class="file-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                      <polyline points="14 2 14 8 20 8"/>
                    </svg>
                  </div>
                  <span class="file-name" id="file-name">document.pdf</span>
                  <button type="button" class="file-remove-btn" id="file-remove-btn" title="Remove file">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <line x1="18" y1="6" x2="6" y2="18"/>
                      <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                  </button>
                </div>
              </div>
              <span class="input-hint">Upload a pitch deck, executive summary, or company overview. Can be used alone or with a website URL.</span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group flex-1">
              <label for="sca-name">Advisor Name</label>
              <input 
                type="text" 
                id="sca-name" 
                name="sca-name" 
                placeholder="e.g., John Smith"
                required
              >
              <span class="input-hint">This will appear on the exported report</span>
            </div>
            <div class="form-group flex-1">
              <label for="portfolio">Portfolio / Cohort</label>
              <select 
                id="portfolio" 
                name="portfolio"
                class="form-select"
              >
                <!-- Keep aligned with RL Tool PORTFOLIOS constant in constants.js -->
                <option value="">Select Portfolio</option>
                <option value="Northeastern CRI - 2026">Northeastern CRI - 2026</option>
                <option value="Penn State GAP - 2026">Penn State GAP - 2026</option>
                <option value="Other">Other</option>
              </select>
              <span class="input-hint">Group ventures for comparison (optional)</span>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" id="load-previous-btn" class="btn outline">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
              </svg>
              Load Previous
            </button>
            <button type="submit" id="start-btn" class="btn primary large">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <polygon points="10 8 16 12 10 16 10 8" fill="currentColor" stroke="none"/>
              </svg>
              Start Assessment
            </button>
          </div>
        </form>
      </div>
    </section>

    <!-- Admin Import Panel (hidden unless ?admin=true in URL) -->
    <section id="admin-panel" class="admin-panel hidden">
      <div class="admin-card">
        <div class="admin-header">
          <h3>Admin: Import Assessment Data</h3>
          <button id="admin-close-btn" class="btn-icon" title="Close admin panel">&times;</button>
        </div>
        <div class="admin-content">
          <div class="admin-fields-row">
            <div class="admin-field">
              <label for="admin-venture-name">Venture Name</label>
              <input type="text" id="admin-venture-name" placeholder="Enter venture name">
            </div>
            <div class="admin-field">
              <label for="admin-advisor-name">Advisor Name</label>
              <input type="text" id="admin-advisor-name" placeholder="Enter advisor name">
            </div>
          </div>
          <div class="admin-import-phases">
            <div class="admin-phase">
              <label>Company JSON <span class="admin-status" id="admin-company-status"></span></label>
              <textarea id="admin-company-json" rows="3" placeholder="Paste Company analysis JSON..."></textarea>
            </div>
            <div class="admin-phase">
              <label>Team JSON <span class="admin-status" id="admin-team-status"></span></label>
              <textarea id="admin-team-json" rows="3" placeholder="Paste Team analysis JSON..."></textarea>
            </div>
            <div class="admin-phase">
              <label>Funding JSON <span class="admin-status" id="admin-funding-status"></span></label>
              <textarea id="admin-funding-json" rows="3" placeholder="Paste Funding analysis JSON..."></textarea>
            </div>
            <div class="admin-phase">
              <label>Competitive JSON <span class="admin-status" id="admin-competitive-status"></span></label>
              <textarea id="admin-competitive-json" rows="3" placeholder="Paste Competitive analysis JSON..."></textarea>
            </div>
            <div class="admin-phase">
              <label>Market JSON <span class="admin-status" id="admin-market-status"></span></label>
              <textarea id="admin-market-json" rows="3" placeholder="Paste Market analysis JSON..."></textarea>
            </div>
            <div class="admin-phase">
              <label>IP Risk JSON <span class="admin-status" id="admin-iprisk-status"></span></label>
              <textarea id="admin-iprisk-json" rows="3" placeholder="Paste IP Risk analysis JSON..."></textarea>
            </div>
          </div>
          <div class="admin-actions">
            <button id="admin-import-btn" class="btn primary">Import & Load Assessment</button>
            <button id="admin-clear-btn" class="btn outline">Clear All</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Progress Section (shown during analysis) -->
    <section id="progress-section" class="progress-section hidden">
      <div class="progress-container">
        <div class="progress-header">
          <h2>Analysis in Progress</h2>
          <p id="progress-company-name">Analyzing company...</p>
        </div>
        
        <div class="progress-bar-container">
          <div class="progress-bar">
            <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
          </div>
          <div class="progress-stats">
            <span id="progress-percentage">0%</span>
            <span id="progress-elapsed"></span>
            <span id="progress-time">Estimated: ~10 min</span>
          </div>
          <div id="progress-message" class="progress-message hidden"></div>
        </div>
        
        <div class="phase-list" id="phase-list">
          <div class="phase-item" data-phase="company">
            <span class="phase-icon pending">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
              </svg>
            </span>
            <span class="phase-name">Company Overview</span>
            <span class="phase-status">Pending</span>
          </div>
          <div class="phase-item" data-phase="team">
            <span class="phase-icon pending">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
              </svg>
            </span>
            <span class="phase-name">Researcher Aptitude</span>
            <span class="phase-status">Pending</span>
          </div>
          <div class="phase-item" data-phase="funding">
            <span class="phase-icon pending">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
              </svg>
            </span>
            <span class="phase-name">Sector Funding Activity</span>
            <span class="phase-status">Pending</span>
          </div>
          <div class="phase-item" data-phase="competitive">
            <span class="phase-icon pending">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
              </svg>
            </span>
            <span class="phase-name">Competitive Winnability</span>
            <span class="phase-status">Pending</span>
          </div>
          <div class="phase-item" data-phase="market">
            <span class="phase-icon pending">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
              </svg>
            </span>
            <span class="phase-name">Market Opportunity</span>
            <span class="phase-status">Pending</span>
          </div>
          <div class="phase-item" data-phase="iprisk">
            <span class="phase-icon pending">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
              </svg>
            </span>
            <span class="phase-name">IP Landscape</span>
            <span class="phase-status">Pending</span>
          </div>
        </div>
        
        <div class="progress-actions">
          <button id="cancel-btn" class="btn outline danger">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M15 9l-6 6M9 9l6 6"/>
            </svg>
            Cancel Analysis
          </button>
        </div>
      </div>
    </section>

    <!-- Results Section (shown after analysis starts completing) -->
    <section id="results-section" class="results-section hidden">
      <!-- Compact Progress Bar (shown while some phases still running) -->
      <div id="compact-progress" class="compact-progress hidden">
        <div class="compact-progress-inner">
          <span class="compact-progress-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="spin">
              <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
            </svg>
          </span>
          <span id="compact-progress-text">4 of 6 complete</span>
          <div class="compact-progress-bar">
            <div id="compact-progress-fill" class="compact-progress-fill" style="width: 66%"></div>
          </div>
          <span id="compact-progress-time">~8 min remaining</span>
        </div>
      </div>

      <!-- Editable Venture Name Header -->
      <div class="venture-name-header">
        <div class="venture-name-display">
          <h1 id="venture-name-text" class="venture-name-text">Loading...</h1>
          <button id="edit-venture-name-btn" class="edit-name-btn" title="Edit venture name">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
          </button>
        </div>
        <p class="venture-name-hint">Click the pencil to edit if the name is incorrect</p>
        <div id="venture-name-edit" class="venture-name-edit hidden">
          <input type="text" id="venture-name-input" class="venture-name-input" placeholder="Enter venture name">
          <button id="save-venture-name-btn" class="btn primary small">Save</button>
          <button id="cancel-venture-name-btn" class="btn outline small">Cancel</button>
        </div>
      </div>

      <!-- Tab Navigation -->
      <nav class="tab-nav" role="tablist">
        <button class="tab-btn" data-tab="overview" role="tab" aria-selected="false" disabled>
          <span class="tab-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2"/>
              <path d="M3 9h18M9 21V9"/>
            </svg>
          </span>
          <span class="tab-label">Overview</span>
          <span class="tab-status pending"></span>
        </button>
        <button class="tab-btn" data-tab="team" role="tab" aria-selected="false" disabled>
          <span class="tab-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
          </span>
          <span class="tab-label">Researcher Aptitude</span>
          <span class="tab-status pending"></span>
        </button>
        <button class="tab-btn" data-tab="funding" role="tab" aria-selected="false" disabled>
          <span class="tab-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="1" x2="12" y2="23"/>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
          </span>
          <span class="tab-label">Sector Funding</span>
          <span class="tab-status pending"></span>
        </button>
        <button class="tab-btn" data-tab="competitive" role="tab" aria-selected="false" disabled>
          <span class="tab-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
          </span>
          <span class="tab-label">Competitive</span>
          <span class="tab-status pending"></span>
        </button>
        <button class="tab-btn" data-tab="market" role="tab" aria-selected="false" disabled>
          <span class="tab-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="20" x2="18" y2="10"/>
              <line x1="12" y1="20" x2="12" y2="4"/>
              <line x1="6" y1="20" x2="6" y2="14"/>
            </svg>
          </span>
          <span class="tab-label">Market</span>
          <span class="tab-status pending"></span>
        </button>
        <button class="tab-btn" data-tab="iprisk" role="tab" aria-selected="false" disabled>
          <span class="tab-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            </svg>
          </span>
          <span class="tab-label">IP Landscape</span>
          <span class="tab-status pending"></span>
        </button>
        <button class="tab-btn" data-tab="solutionvalue" role="tab" aria-selected="false" disabled>
          <span class="tab-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/><path d="M2 20h20"/>
            </svg>
          </span>
          <span class="tab-label">Solution Value</span>
          <span class="tab-status pending"></span>
        </button>
        <button class="tab-btn" data-tab="summary" role="tab" aria-selected="false" disabled>
          <span class="tab-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14 2 14 8 20 8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <polyline points="10 9 9 9 8 9"/>
            </svg>
          </span>
          <span class="tab-label">Summary</span>
          <span class="tab-status pending"></span>
        </button>
      </nav>

      <!-- Tab Content Panels -->
      <div class="tab-panels">
        <!-- Overview Panel -->
        <div id="panel-overview" class="tab-panel" role="tabpanel" hidden>
          <div class="panel-header">
            <h2>Company Overview</h2>
          </div>
          <div class="panel-content" id="overview-content">
            <!-- Populated by JavaScript -->
          </div>
        </div>

        <!-- Team Panel -->
        <div id="panel-team" class="tab-panel" role="tabpanel" hidden>
          <div class="panel-header">
            <h2>Researcher Aptitude Assessment</h2>
            <div class="score-badge" id="team-score-badge">
              <span class="score-label">AI Score</span>
              <span class="score-value" id="team-ai-score">-</span>
            </div>
          </div>
          <p class="assessment-guidance">Score CV/resume only. Strong academic signals earn points even if translation is unclear, but unclear translation caps the score (typically &#8804;6). Adjust for career stage.</p>
          <div class="panel-content">
            <div class="assessment-layout">
              <div class="evidence-section">
                <div class="view-toggles">
                  <button class="view-toggle-btn active" data-view="summary">Summary</button>
                  <button class="view-toggle-btn" data-view="detailed">Detailed</button>
                  <button class="view-toggle-btn" data-view="sources">Sources</button>
                </div>
                <div id="team-evidence" class="evidence-container">
                  <!-- Populated by JavaScript -->
                </div>
              </div>
              <div class="scoring-section">
                <div class="scoring-card" id="team-scoring-card">
                  <h3>Your Assessment</h3>
                  <div class="score-slider-container">
                    <label for="team-score-slider">Score (1-9)</label>
                    <input type="range" id="team-score-slider" min="1" max="9" value="5" class="score-slider">
                    <div class="score-display">
                      <span id="team-user-score" class="user-score">5</span>
                    </div>
                  </div>
                  <div id="team-rubric" class="rubric-display">
                    <!-- Rubric definition appears here -->
                  </div>
                  <div class="score-deviation hidden" id="team-deviation">
                    <span class="deviation-icon">⚠️</span>
                    <span class="deviation-text">Your score differs from AI by <span class="deviation-value">0</span></span>
                  </div>
                  <div class="justification-container">
                    <label for="team-justification">Justification (optional)</label>
                    <textarea id="team-justification" rows="3" placeholder="Explain your reasoning..."></textarea>
                  </div>
                  <button id="team-submit-btn" class="btn primary submit-btn">Submit Assessment</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Funding Panel -->
        <div id="panel-funding" class="tab-panel" role="tabpanel" hidden>
          <div class="panel-header">
            <h2>Sector Funding Activity Assessment</h2>
            <div class="score-badge" id="funding-score-badge">
              <span class="score-label">AI Score</span>
              <span class="score-value" id="funding-ai-score">-</span>
            </div>
          </div>
          <p class="assessment-guidance">Score sector-wide funding activity (VC/corp/grants), not the venture's fundraising plan. Use evidence from the last ~24 months plus a 3-5 year outlook.</p>
          <div class="panel-content">
            <div class="assessment-layout">
              <div class="evidence-section">
                <div class="view-toggles">
                  <button class="view-toggle-btn active" data-view="summary">Summary</button>
                  <button class="view-toggle-btn" data-view="detailed">Detailed</button>
                  <button class="view-toggle-btn" data-view="sources">Sources</button>
                </div>
                <div id="funding-evidence" class="evidence-container">
                  <!-- Populated by JavaScript -->
                </div>
              </div>
              <div class="scoring-section">
                <div class="scoring-card" id="funding-scoring-card">
                  <h3>Your Assessment</h3>
                  <div class="score-slider-container">
                    <label for="funding-score-slider">Score (1-9)</label>
                    <input type="range" id="funding-score-slider" min="1" max="9" value="5" class="score-slider">
                    <div class="score-display">
                      <span id="funding-user-score" class="user-score">5</span>
                    </div>
                  </div>
                  <div id="funding-rubric" class="rubric-display">
                    <!-- Rubric definition appears here -->
                  </div>
                  <div class="score-deviation hidden" id="funding-deviation">
                    <span class="deviation-icon">⚠️</span>
                    <span class="deviation-text">Your score differs from AI by <span class="deviation-value">0</span></span>
                  </div>
                  <div class="justification-container">
                    <label for="funding-justification">Justification (optional)</label>
                    <textarea id="funding-justification" rows="3" placeholder="Explain your reasoning..."></textarea>
                  </div>
                  <button id="funding-submit-btn" class="btn primary submit-btn">Submit Assessment</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Competitive Panel -->
        <div id="panel-competitive" class="tab-panel" role="tabpanel" hidden>
          <div class="panel-header">
            <h2>Competitive Winnability Assessment</h2>
            <div class="score-badge" id="competitive-score-badge">
              <span class="score-label">AI Score</span>
              <span class="score-value" id="competitive-ai-score">-</span>
            </div>
          </div>
          <p class="assessment-guidance">Score net attractiveness/winnability: competition intensity AND clarity of differentiation + ability to capture value over the next 3-5 years.</p>
          <div class="panel-content">
            <div class="assessment-layout">
              <div class="evidence-section">
                <div class="view-toggles">
                  <button class="view-toggle-btn active" data-view="summary">Summary</button>
                  <button class="view-toggle-btn" data-view="detailed">Detailed</button>
                  <button class="view-toggle-btn" data-view="sources">Sources</button>
                </div>
                <div id="competitive-evidence" class="evidence-container">
                  <!-- Populated by JavaScript -->
                </div>
              </div>
              <div class="scoring-section">
                <div class="scoring-card" id="competitive-scoring-card">
                  <h3>Your Assessment</h3>
                  <div class="score-slider-container">
                    <label for="competitive-score-slider">Score (1-9)</label>
                    <input type="range" id="competitive-score-slider" min="1" max="9" value="5" class="score-slider">
                    <div class="score-display">
                      <span id="competitive-user-score" class="user-score">5</span>
                    </div>
                  </div>
                  <div id="competitive-rubric" class="rubric-display">
                    <!-- Rubric definition appears here -->
                  </div>
                  <div class="score-deviation hidden" id="competitive-deviation">
                    <span class="deviation-icon">⚠️</span>
                    <span class="deviation-text">Your score differs from AI by <span class="deviation-value">0</span></span>
                  </div>
                  <div class="justification-container">
                    <label for="competitive-justification">Justification (optional)</label>
                    <textarea id="competitive-justification" rows="3" placeholder="Explain your reasoning..."></textarea>
                  </div>
                  <button id="competitive-submit-btn" class="btn primary submit-btn">Submit Assessment</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Market Panel -->
        <div id="panel-market" class="tab-panel" role="tabpanel" hidden>
          <div class="panel-header">
            <h2>Market Opportunity Assessment</h2>
            <div class="score-badge" id="market-score-badge">
              <span class="score-label">AI Score</span>
              <span class="score-value" id="market-ai-score">-</span>
            </div>
          </div>
          <p class="assessment-guidance">Use best available estimates. If TAM/CAGR are available, use them; if not, use credible proxies and map to the closest band.</p>
          <div class="panel-content">
            <div class="assessment-layout">
              <div class="evidence-section">
                <div class="view-toggles">
                  <button class="view-toggle-btn active" data-view="summary">Summary</button>
                  <button class="view-toggle-btn" data-view="detailed">Detailed</button>
                  <button class="view-toggle-btn" data-view="sources">Sources</button>
                </div>
                <div id="market-evidence" class="evidence-container">
                  <!-- Populated by JavaScript -->
                </div>
              </div>
              <div class="scoring-section">
                <div class="scoring-card" id="market-scoring-card">
                  <h3>Your Assessment</h3>
                  <div class="score-slider-container">
                    <label for="market-score-slider">Score (1-9)</label>
                    <input type="range" id="market-score-slider" min="1" max="9" value="5" class="score-slider">
                    <div class="score-display">
                      <span id="market-user-score" class="user-score">5</span>
                    </div>
                  </div>
                  <div id="market-rubric" class="rubric-display">
                    <!-- Rubric definition appears here -->
                  </div>
                  <div class="score-deviation hidden" id="market-deviation">
                    <span class="deviation-icon">⚠️</span>
                    <span class="deviation-text">Your score differs from AI by <span class="deviation-value">0</span></span>
                  </div>
                  <div class="justification-container">
                    <label for="market-justification">Justification (optional)</label>
                    <textarea id="market-justification" rows="3" placeholder="Explain your reasoning..."></textarea>
                  </div>
                  <button id="market-submit-btn" class="btn primary submit-btn">Submit Assessment</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- IP Risk Panel -->
        <div id="panel-iprisk" class="tab-panel" role="tabpanel" hidden>
          <div class="panel-header">
            <h2>IP Landscape Assessment</h2>
            <div class="score-badge" id="iprisk-score-badge">
              <span class="score-label">AI Score</span>
              <span class="score-value" id="iprisk-ai-score">-</span>
            </div>
          </div>
          <p class="assessment-guidance">Score freedom-to-operate risk AND future protectability. Not a count of existing patents; note what diligence would change the score.</p>
          <div class="panel-content">
            <div class="assessment-layout">
              <div class="evidence-section">
                <div class="view-toggles">
                  <button class="view-toggle-btn active" data-view="summary">Summary</button>
                  <button class="view-toggle-btn" data-view="detailed">Detailed</button>
                  <button class="view-toggle-btn" data-view="sources">Sources</button>
                </div>
                <div id="iprisk-evidence" class="evidence-container">
                  <!-- Populated by JavaScript -->
                </div>
              </div>
              <div class="scoring-section">
                <div class="scoring-card" id="iprisk-scoring-card">
                  <h3>Your Assessment</h3>
                  <div class="score-slider-container">
                    <label for="iprisk-score-slider">Score (1-9)</label>
                    <input type="range" id="iprisk-score-slider" min="1" max="9" value="5" class="score-slider">
                    <div class="score-display">
                      <span id="iprisk-user-score" class="user-score">5</span>
                    </div>
                  </div>
                  <div id="iprisk-rubric" class="rubric-display">
                    <!-- Rubric definition appears here -->
                  </div>
                  <div class="score-deviation hidden" id="iprisk-deviation">
                    <span class="deviation-icon">⚠️</span>
                    <span class="deviation-text">Your score differs from AI by <span class="deviation-value">0</span></span>
                  </div>
                  <div class="justification-container">
                    <label for="iprisk-justification">Justification (optional)</label>
                    <textarea id="iprisk-justification" rows="3" placeholder="Explain your reasoning..."></textarea>
                  </div>
                  <button id="iprisk-submit-btn" class="btn primary submit-btn">Submit Assessment</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Solution Value Panel (User-Scored Only) -->
        <div id="panel-solutionvalue" class="tab-panel" role="tabpanel" hidden>
          <div class="panel-header">
            <h2>Solution Value Assessment</h2>
            <div class="score-badge user-only" id="solutionvalue-score-badge">
              <span class="score-label">User Score Only</span>
              <span class="score-value" id="solutionvalue-user-score-badge">-</span>
            </div>
          </div>
          <p class="assessment-guidance">Qualitative assessment of the magnitude of benefit the solution delivers to the beachhead customer vs current alternatives and the degree to which it addresses a real, current unmet need. Do not consider TAM, funding climate, competitive landscape, IP, or team.</p>
          <div class="panel-content">
            <div class="assessment-layout">
              <div class="evidence-section">
                <h3>Aggregated Evidence</h3>
                <div id="solutionvalue-evidence" class="evidence-container">
                  <div class="evidence-pending-notice">
                    <p>Evidence will populate as analyses complete. This section aggregates findings from the Company, Market, and Competitive analyses.</p>
                  </div>
                </div>
              </div>
              <div class="scoring-section">
                <div class="scoring-card" id="solutionvalue-scoring-card">
                  <h3>Your Assessment</h3>
                  <div class="score-slider-container">
                    <label for="solutionvalue-score-slider">Score (1-9)</label>
                    <input type="range" id="solutionvalue-score-slider" min="1" max="9" value="5" class="score-slider">
                    <div class="score-display">
                      <span id="solutionvalue-user-score" class="user-score">5</span>
                    </div>
                  </div>
                  <div id="solutionvalue-rubric" class="rubric-display">
                    <!-- Rubric definition appears here -->
                  </div>
                  <div class="justification-container">
                    <label for="solutionvalue-justification">Justification (required)</label>
                    <textarea id="solutionvalue-justification" rows="3" placeholder="Explain your reasoning for this Solution Value score..."></textarea>
                  </div>
                  <button id="solutionvalue-submit-btn" class="btn primary submit-btn">Submit Assessment</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Summary Panel -->
        <div id="panel-summary" class="tab-panel" role="tabpanel" hidden>
          <div class="panel-header">
            <h2>Assessment Summary</h2>
          </div>
          <div class="panel-content" id="summary-content">
            <!-- Populated by JavaScript -->
          </div>

          <!-- Final Recommendation Section -->
          <div id="final-recommendation-section" class="final-recommendation hidden">
            <div class="recommendation-header">
              <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                  <polyline points="14,2 14,8 20,8"/>
                  <line x1="16" y1="13" x2="8" y2="13"/>
                  <line x1="16" y1="17" x2="8" y2="17"/>
                </svg>
                Final Recommendation
              </h3>
              <p class="recommendation-hint">Provide your overall assessment, key concerns, or recommendation for this venture.</p>
            </div>
            <textarea
              id="final-recommendation-text"
              rows="5"
              placeholder="Enter your overall comments and recommendation..."
              maxlength="2000"
            ></textarea>
            <div class="recommendation-footer">
              <span id="recommendation-char-count">0 / 2000</span>
              <button id="submit-final-recommendation" class="btn primary" disabled>
                Submit Final Assessment
              </button>
            </div>
          </div>

          <!-- Database Sync Section -->
          <div id="database-sync-section" class="database-sync-section">
            <div class="sync-header">
              <h3>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 12a9 9 0 0 1-9 9m9-9a9 9 0 0 0-9-9m9 9H3m9 9a9 9 0 0 1-9-9m9 9c1.66 0 3-4.03 3-9s-1.34-9-3-9m0 18c-1.66 0-3-4.03-3-9s1.34-9 3-9"/>
                </svg>
                Database Sync Status
              </h3>
            </div>
            <div id="sync-status-content" class="sync-status-content">
              <p class="sync-hint">Check if your scores have been saved to the database.</p>
            </div>
            <div class="sync-footer">
              <button id="check-sync-status" class="btn outline">
                Check Status
              </button>
              <button id="force-sync-btn" class="btn primary">
                Force Sync All Data
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Toast Container -->
  <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

  <!-- Modal Overlay -->
  <div id="modal-overlay" class="modal-overlay">
    <div id="modal-content" class="modal-content" role="dialog" aria-modal="true">
      <!-- Modal content injected by JavaScript -->
    </div>
  </div>

  <!-- Scripts -->
  <!-- Utilities (debug.js must load first) -->
  <script src="js/utils/debug.js"></script>
  <script src="js/utils/validators.js"></script>
  <script src="js/utils/formatters.js"></script>
  <script src="js/utils/export.js"></script>
  <script src="js/utils/sharepoint.js"></script>
  <script src="js/utils/smartsheet.js"></script>
  <script src="js/utils/confidence.js"></script>
  
  <!-- Config -->
  <script src="js/config/sharepoint-config.js"></script>
  
  <!-- API Layer -->
  <script src="js/api/stack-proxy-v2.js"></script>
  <script src="js/api/company.js"></script>
  <script src="js/api/team.js"></script>
  <script src="js/api/funding.js"></script>
  <script src="js/api/competitive.js"></script>
  <script src="js/api/market.js"></script>
  <script src="js/api/iprisk.js"></script>
  
  <!-- Components -->
  <script src="js/components/tab-manager.js"></script>
  <script src="js/components/toast-manager.js"></script>
  <script src="js/components/modal-manager.js"></script>
  <script src="js/components/progress-view.js"></script>
  <script src="js/components/assessment-view.js"></script>
  <script src="js/components/summary-view.js"></script>
  
  <!-- Core -->
  <script src="js/core/state-manager.js"></script>
  <script src="js/core/pipeline.js"></script>
  <script src="js/core/app.js"></script>
</body>
</html>
